<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gammapy.background.models &mdash; gammapy v0.3</title>
    
    <link rel="stylesheet" href="../../../_static/gammapy.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="gammapy v0.3" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />

<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../_static/copybutton.js"></script>


<!-- RTD Extra Head -->



<!-- 
Read the Docs is acting as the canonical URL for your project. 
If you want to change it, more info is available in our docs:
  http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://gammapy.readthedocs.org/en/latest/_modules/gammapy/background/models.html" />

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "gammapy",
    version: "v0.3",
    language: "en",
    page: "_modules/gammapy/background/models",
    builder: "sphinx",
    theme: "bootstrap-astropy",
    docroot: "/docs/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org/",
    commit: "ca867804d285620b924a351759160108b986f5bd"
  }
  // Old variables
  var doc_version = "v0.3";
  var doc_slug = "gammapy";
  var page_name = "_modules/gammapy/background/models";
  var html_theme = "bootstrap-astropy";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->

  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../index.html"><span id="logotext1">gamma</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="http://gammapy.readthedocs.io/en/v0.3/search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../index.html">gammapy v0.3</a>
	 &raquo;
      </li>
      <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gammapy.background.models</h1><div class="highlight"><pre>
<span class="c"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
<span class="sd">&quot;&quot;&quot;Background models.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Gaussian1D</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">..utils.wcs</span> <span class="kn">import</span> <span class="p">(</span><span class="n">linear_wcs_to_arrays</span><span class="p">,</span>
                         <span class="n">linear_arrays_to_wcs</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..utils.fits</span> <span class="kn">import</span> <span class="n">table_to_fits_table</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GaussianBand2D&#39;</span><span class="p">,</span>
           <span class="s">&#39;CubeBackgroundModel&#39;</span><span class="p">,</span>
           <span class="p">]</span>

<span class="n">DEFAULT_SPLINE_KWARGS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<div class="viewcode-block" id="GaussianBand2D"><a class="viewcode-back" href="../../../api/gammapy.background.GaussianBand2D.html#gammapy.background.GaussianBand2D">[docs]</a><span class="k">class</span> <span class="nc">GaussianBand2D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Gaussian band model.</span>

<span class="sd">    This 2-dimensional model is Gaussian in ``y`` for a given ``x``,</span>
<span class="sd">    and the Gaussian parameters can vary in ``x``.</span>

<span class="sd">    One application of this model is the diffuse emission along the</span>
<span class="sd">    Galactic plane, i.e. ``x = GLON`` and ``y = GLAT``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : `~astropy.table.Table`</span>
<span class="sd">        Table of Gaussian parameters.</span>
<span class="sd">        ``x``, ``amplitude``, ``mean``, ``stddev``.</span>
<span class="sd">    spline_kwargs : dict</span>
<span class="sd">        Keyword arguments passed to `~scipy.interpolate.UnivariateSpline`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">spline_kwargs</span><span class="o">=</span><span class="n">DEFAULT_SPLINE_KWARGS</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;amplitude&#39;</span><span class="p">,</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="s">&#39;stddev&#39;</span><span class="p">]</span>

        <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parnames</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parname</span><span class="p">]</span>
            <span class="n">s</span><span class="p">[</span><span class="n">parname</span><span class="p">]</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">spline_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_par_model</span> <span class="o">=</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_evaluate_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate Gaussian model at a given ``y`` position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Gaussian1D</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">)</span>

<div class="viewcode-block" id="GaussianBand2D.parvals"><a class="viewcode-back" href="../../../api/gammapy.background.GaussianBand2D.html#gammapy.background.GaussianBand2D.parvals">[docs]</a>    <span class="k">def</span> <span class="nf">parvals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolated parameter values at a given ``x``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">parvals</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parnames</span><span class="p">:</span>
            <span class="n">par_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_par_model</span><span class="p">[</span><span class="n">parname</span><span class="p">]</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">parvals</span><span class="p">[</span><span class="n">parname</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_model</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parvals</span>
</div>
<div class="viewcode-block" id="GaussianBand2D.y_model"><a class="viewcode-back" href="../../../api/gammapy.background.GaussianBand2D.html#gammapy.background.GaussianBand2D.y_model">[docs]</a>    <span class="k">def</span> <span class="nf">y_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create model at a given ``x`` position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">parvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parvals</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Gaussian1D</span><span class="p">(</span><span class="o">**</span><span class="n">parvals</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GaussianBand2D.evaluate"><a class="viewcode-back" href="../../../api/gammapy.background.GaussianBand2D.html#gammapy.background.GaussianBand2D.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate model at a given position ``(x, y)`` position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">parvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parvals</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_y</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">parvals</span><span class="p">)</span>

</div></div>
<span class="k">def</span> <span class="nf">_make_bin_edges_array</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make bin edges array from a low values and a high values array.</span>

<span class="sd">    TODO: move this function to somewhere else? (i.e. utils?)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lo : `~numpy.ndarray`</span>
<span class="sd">        lower boundaries</span>
<span class="sd">    hi : `~numpy.ndarray`</span>
<span class="sd">        higher boundaries</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bin_edges : `~numpy.ndarray`</span>
<span class="sd">        array of bin edges as [[low], [high]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lo</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">hi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>


<span class="k">def</span> <span class="nf">_parse_bg_units</span><span class="p">(</span><span class="n">background_unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function to parse the bg units correctly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># try 1st to parse them as astropy units</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">background_unit</span><span class="p">)</span>
    <span class="c"># if it fails, try to parse them manually</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">tev_units</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1/s/TeV/sr&#39;</span><span class="p">,</span> <span class="s">&#39;s-1 sr-1 TeV-1&#39;</span><span class="p">,</span> <span class="s">&#39;1 / (s sr TeV)&#39;</span><span class="p">,</span>
                     <span class="s">&#39;1 / (TeV s sr)&#39;</span><span class="p">]</span>
        <span class="n">mev_units</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1/s/MeV/sr&#39;</span><span class="p">,</span> <span class="s">&#39;MeV-1 s-1 sr-1&#39;</span><span class="p">,</span> <span class="s">&#39;1 / (s sr MeV)&#39;</span><span class="p">,</span>
                     <span class="s">&#39;1 / (MeV s sr)&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">background_unit</span> <span class="ow">in</span> <span class="n">tev_units</span><span class="p">:</span>
            <span class="n">background_unit</span> <span class="o">=</span> <span class="s">&#39;1 / (s TeV sr)&#39;</span>
        <span class="k">elif</span> <span class="n">background_unit</span> <span class="ow">in</span> <span class="n">mev_units</span><span class="p">:</span>
            <span class="n">background_unit</span> <span class="o">=</span> <span class="s">&#39;1 / (s MeV sr)&#39;</span>
        <span class="c"># if it still fails, raise an exception</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Cannot interpret units ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">background_unit</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">background_unit</span>


<div class="viewcode-block" id="CubeBackgroundModel"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel">[docs]</a><span class="k">class</span> <span class="nc">CubeBackgroundModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Cube background model.</span>

<span class="sd">    Container class for cube background model (X, Y, energy).</span>
<span class="sd">    (X, Y) are detector coordinates (a.k.a. nominal system).</span>
<span class="sd">    The class hass methods for reading a model from a fits file,</span>
<span class="sd">    write a model to a fits file and plot the models.</span>

<span class="sd">    The order of the axes in the background cube is `(E, y, x)`,</span>
<span class="sd">    so in order to access the data correctly, the call is</span>
<span class="sd">    `bg_cube_model.background[energy_bin, dety_bin, detx_bin]`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    detx_bins : `~astropy.coordinates.Angle`</span>
<span class="sd">        Spatial bin edges vector (low and high). X coordinate.</span>
<span class="sd">    dety_bins : `~astropy.coordinates.Angle`</span>
<span class="sd">        Spatial bin edges vector (low and high). Y coordinate.</span>
<span class="sd">    energy_bins : `~astropy.units.Quantity`</span>
<span class="sd">        Energy bin edges vector (low and high).</span>
<span class="sd">    background : `~astropy.units.Quantity`</span>
<span class="sd">        Background cube in (energy, X, Y) format.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Access cube bg model data:</span>

<span class="sd">    .. code:: python</span>

<span class="sd">        energy_bin = bg_cube_model.find_energy_bin(energy=Quantity(2., &#39;TeV&#39;))</span>
<span class="sd">        det_bin = bg_cube_model.find_det_bin(det=Angle([0., 0.], &#39;degree&#39;))</span>
<span class="sd">        bg_cube_model.background[energy_bin, det_bin[1], det_bin[0]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detx_bins</span><span class="p">,</span> <span class="n">dety_bins</span><span class="p">,</span> <span class="n">energy_bins</span><span class="p">,</span> <span class="n">background</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span> <span class="o">=</span> <span class="n">detx_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span> <span class="o">=</span> <span class="n">dety_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span> <span class="o">=</span> <span class="n">energy_bins</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">background</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="CubeBackgroundModel.from_fits_table"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.from_fits_table">[docs]</a>    <span class="k">def</span> <span class="nf">from_fits_table</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">hdu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read cube background model from a fits binary table.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdu : `~astropy.io.fits.BinTableHDU`</span>
<span class="sd">            HDU binary table for the bg cube</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bg_cube : `~gammapy.background.CubeBackgroundModel`</span>
<span class="sd">            bg model cube object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>

        <span class="c"># check correct axis order: 1st X, 2nd Y, 3rd energy, 4th bg</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;DETX_LO&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE2&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;DETX_HI&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting X axis in first 2 places, not ({0}, {1})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE1&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE2&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;DETY_LO&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE4&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;DETY_HI&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting Y axis in second 2 places, not ({0}, {1})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE3&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE4&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE5&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;ENERG_LO&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE6&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;ENERG_HI&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting E axis in third 2 places, not ({0}, {1})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE5&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE6&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE7&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;Bgd&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting bg axis in fourth place, not ({})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TTYPE7&#39;</span><span class="p">]))</span>

        <span class="c"># get det X, Y binning</span>
        <span class="n">detx_bins</span> <span class="o">=</span> <span class="n">_make_bin_edges_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;DETX_LO&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;DETX_HI&#39;</span><span class="p">])</span>
        <span class="n">dety_bins</span> <span class="o">=</span> <span class="n">_make_bin_edges_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;DETY_LO&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;DETY_HI&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT2&#39;</span><span class="p">]:</span>
            <span class="n">detx_unit</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT1&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Detector X units not matching ({0}, {1})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT1&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT2&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT4&#39;</span><span class="p">]:</span>
            <span class="n">dety_unit</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT3&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Detector Y units not matching ({0}, {1})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT3&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT4&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">detx_unit</span> <span class="o">==</span> <span class="n">dety_unit</span><span class="p">:</span>
            <span class="n">ss_error</span> <span class="o">=</span> <span class="s">&quot;This is odd: detector X and Y units not matching&quot;</span>
            <span class="n">ss_error</span> <span class="o">+=</span> <span class="s">&quot;({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">detx_unit</span><span class="p">,</span> <span class="n">dety_unit</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">ss_error</span><span class="p">)</span>
        <span class="n">detx_bins</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">detx_bins</span><span class="p">,</span> <span class="n">detx_unit</span><span class="p">)</span>
        <span class="n">dety_bins</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">dety_bins</span><span class="p">,</span> <span class="n">dety_unit</span><span class="p">)</span>

        <span class="c"># get energy binning</span>
        <span class="n">energy_bins</span> <span class="o">=</span> <span class="n">_make_bin_edges_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ENERG_LO&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;ENERG_HI&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT5&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT6&#39;</span><span class="p">]:</span>
            <span class="n">energy_unit</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT5&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Energy units not matching ({0}, {1})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT5&#39;</span><span class="p">],</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT6&#39;</span><span class="p">]))</span>
        <span class="n">energy_bins</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">energy_bins</span><span class="p">,</span> <span class="n">energy_unit</span><span class="p">)</span>

        <span class="c"># get background data</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Bgd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">background_unit</span> <span class="o">=</span> <span class="n">_parse_bg_units</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;TUNIT7&#39;</span><span class="p">])</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">background_unit</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">detx_bins</span><span class="o">=</span><span class="n">detx_bins</span><span class="p">,</span>
                   <span class="n">dety_bins</span><span class="o">=</span><span class="n">dety_bins</span><span class="p">,</span>
                   <span class="n">energy_bins</span><span class="o">=</span><span class="n">energy_bins</span><span class="p">,</span>
                   <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="CubeBackgroundModel.from_fits_image"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.from_fits_image">[docs]</a>    <span class="k">def</span> <span class="nf">from_fits_image</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">image_hdu</span><span class="p">,</span> <span class="n">energy_hdu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read cube background model from a fits image.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        image_hdu : `~astropy.io.fits.PrimaryHDU`</span>
<span class="sd">            Background cube image HDU</span>
<span class="sd">        energy_hdu : `~astropy.io.fits.BinTableHDU`</span>
<span class="sd">            Energy binning table</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bg_cube : `~gammapy.background.CubeBackgroundModel`</span>
<span class="sd">            Background cube</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_header</span> <span class="o">=</span> <span class="n">image_hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="n">energy_header</span> <span class="o">=</span> <span class="n">energy_hdu</span><span class="o">.</span><span class="n">header</span>

        <span class="c"># check correct axis order: 1st X, 2nd Y, 3rd energy, 4th bg</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CTYPE1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;DETX&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting X axis in first place, not ({})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CTYPE1&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CTYPE2&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;DETY&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting Y axis in second place, not ({})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CTYPE2&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CTYPE3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;ENERGY&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting E axis in third place, not ({})&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CTYPE3&#39;</span><span class="p">]))</span>

        <span class="c"># check units</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CUNIT1&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CUNIT2&#39;</span><span class="p">]):</span>
            <span class="n">ss_error</span> <span class="o">=</span> <span class="s">&quot;This is odd: detector X and Y units not matching&quot;</span>
            <span class="n">ss_error</span> <span class="o">+=</span> <span class="s">&quot;({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CUNIT1&#39;</span><span class="p">],</span> <span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CUNIT2&#39;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">ss_error</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CUNIT3&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">energy_header</span><span class="p">[</span><span class="s">&#39;TUNIT1&#39;</span><span class="p">]):</span>
            <span class="n">ss_error</span> <span class="o">=</span> <span class="s">&quot;This is odd: energy units not matching&quot;</span>
            <span class="n">ss_error</span> <span class="o">+=</span> <span class="s">&quot;({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;CUNIT3&#39;</span><span class="p">],</span> <span class="n">energy_header</span><span class="p">[</span><span class="s">&#39;TUNIT1&#39;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">ss_error</span><span class="p">)</span>

        <span class="c"># get det X, Y binning</span>
        <span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">image_header</span><span class="p">,</span> <span class="n">naxis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c"># select only the (X, Y) axes</span>
        <span class="n">detx_bins</span><span class="p">,</span> <span class="n">dety_bins</span> <span class="o">=</span> <span class="n">linear_wcs_to_arrays</span><span class="p">(</span><span class="n">wcs</span><span class="p">,</span>
                                                    <span class="n">image_header</span><span class="p">[</span><span class="s">&#39;NAXIS1&#39;</span><span class="p">],</span>
                                                    <span class="n">image_header</span><span class="p">[</span><span class="s">&#39;NAXIS2&#39;</span><span class="p">])</span>

        <span class="c"># get energy binning</span>
        <span class="n">energy_bins</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">energy_hdu</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ENERGY&#39;</span><span class="p">],</span>
                               <span class="n">energy_header</span><span class="p">[</span><span class="s">&#39;TUNIT1&#39;</span><span class="p">])</span>

        <span class="c"># get background data</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">image_hdu</span><span class="o">.</span><span class="n">data</span>
        <span class="n">background_unit</span> <span class="o">=</span> <span class="n">_parse_bg_units</span><span class="p">(</span><span class="n">image_header</span><span class="p">[</span><span class="s">&#39;BG_UNIT&#39;</span><span class="p">])</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">background_unit</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">detx_bins</span><span class="o">=</span><span class="n">detx_bins</span><span class="p">,</span>
                   <span class="n">dety_bins</span><span class="o">=</span><span class="n">dety_bins</span><span class="p">,</span>
                   <span class="n">energy_bins</span><span class="o">=</span><span class="n">energy_bins</span><span class="p">,</span>
                   <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="CubeBackgroundModel.read"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;table&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read cube background model from fits file.</span>

<span class="sd">        Several input formats are accepted, depending on the value</span>
<span class="sd">        of the `format` parameter:</span>

<span class="sd">        * table (default and preferred format): `~astropy.io.fits.BinTableHDU`</span>

<span class="sd">        * image (alternative format): `~astropy.io.fits.PrimaryHDU`,</span>
<span class="sd">          with the energy binning stored as `~astropy.io.fits.BinTableHDU`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            name of file with the bg cube</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            format of the bg cube to read</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bg_cube : `~gammapy.background.CubeBackgroundModel`</span>
<span class="sd">            bg model cube object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;table&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_fits_table</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s">&#39;BACKGROUND&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;image&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_fits_image</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s">&#39;PRIMARY&#39;</span><span class="p">],</span> <span class="n">hdu</span><span class="p">[</span><span class="s">&#39;EBOUNDS&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid format {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.to_table"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.to_table">[docs]</a>    <span class="k">def</span> <span class="nf">to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert cube background model to astropy table format.</span>

<span class="sd">        The name of the table is stored in the table meta information</span>
<span class="sd">        under the keyword &#39;name&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table : `~astropy.table.Table`</span>
<span class="sd">            table containing the bg cube</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># data arrays</span>
        <span class="n">a_detx_lo</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">a_detx_hi</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="n">a_dety_lo</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">a_dety_hi</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="n">a_energy_lo</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">a_energy_hi</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="n">a_bg</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">])</span>

        <span class="c"># table</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;DETX_LO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_detx_lo</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;DETX_HI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_detx_hi</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;DETY_LO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_dety_lo</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;DETY_HI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_dety_hi</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;ENERG_LO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_energy_lo</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;ENERG_HI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_energy_hi</span>
        <span class="n">table</span><span class="p">[</span><span class="s">&#39;Bgd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_bg</span>

        <span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s">&#39;E_THRES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_energy_lo</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;BACKGROUND&#39;</span>

        <span class="k">return</span> <span class="n">table</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.to_fits_table"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.to_fits_table">[docs]</a>    <span class="k">def</span> <span class="nf">to_fits_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert cube background model to binary table fits format.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tbhdu : `~astropy.io.fits.BinTableHDU`</span>
<span class="sd">            table containing the bg cube</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">table_to_fits_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_table</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.to_fits_image"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.to_fits_image">[docs]</a>    <span class="k">def</span> <span class="nf">to_fits_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert cube background model to image fits format.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hdu_list : `~astropy.io.fits.HDUList`</span>
<span class="sd">            HDU list with:</span>

<span class="sd">            * one `~astropy.io.fits.PrimaryHDU` image for the bg cube</span>

<span class="sd">            * one `~astropy.io.fits.BinTableHDU` table for the energy binning</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># data</span>
        <span class="n">imhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">det_wcs</span><span class="o">.</span><span class="n">to_header</span><span class="p">())</span>
        <span class="c"># add some important header information</span>
        <span class="n">imhdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BG_UNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{0.unit:FITS}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="n">imhdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CTYPE3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ENERGY&#39;</span>
        <span class="n">imhdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;CUNIT3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{0.unit:FITS}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">)</span>
        <span class="n">imhdu</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;E_THRES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="c"># get WCS object and write it out as a FITS header</span>
        <span class="n">wcs_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">det_wcs</span><span class="o">.</span><span class="n">to_header</span><span class="p">()</span>

        <span class="c"># get energy values as a table HDU, via an astropy table</span>
        <span class="n">energy_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
        <span class="n">energy_table</span><span class="p">[</span><span class="s">&#39;ENERGY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span>
        <span class="n">energy_table</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;EBOUNDS&#39;</span>
        <span class="c"># TODO: this function should be reviewed/re-written, when</span>
        <span class="c"># the following PR is completed:</span>
        <span class="c"># https://github.com/gammapy/gammapy/pull/290</span>
        <span class="c"># as suggested in:</span>
        <span class="c"># https://github.com/gammapy/gammapy/pull/299#discussion_r35044977</span>

        <span class="n">enhdu</span> <span class="o">=</span> <span class="n">table_to_fits_table</span><span class="p">(</span><span class="n">energy_table</span><span class="p">)</span>

        <span class="n">hdu_list</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">imhdu</span><span class="p">,</span> <span class="n">enhdu</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">hdu_list</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.write"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;table&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write cube background model to fits file.</span>

<span class="sd">        Several output formats are accepted, depending on the value</span>
<span class="sd">        of the `format` parameter:</span>

<span class="sd">        * table (default and preferred format): `~astropy.io.fits.BinTableHDU`</span>
<span class="sd">        * image (alternative format): `~astropy.io.fits.PrimaryHDU`,</span>
<span class="sd">          with the energy binning stored as `~astropy.io.fits.BinTableHDU`</span>

<span class="sd">        Depending on the value of the `format` parameter, this</span>
<span class="sd">        method calls either `~astropy.io.fits.BinTableHDU.writeto` or</span>
<span class="sd">        `~astropy.io.fits.HDUList.writeto`, forwarding the</span>
<span class="sd">        `kwargs` arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        outfile : str</span>
<span class="sd">            name of file to write</span>
<span class="sd">        format : str, optional</span>
<span class="sd">            format of the bg cube to write</span>
<span class="sd">        kwargs</span>
<span class="sd">            extra arguments for the corresponding `io.fits` `writeto` method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;table&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_fits_table</span><span class="p">()</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">format</span> <span class="o">==</span> <span class="s">&#39;image&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_fits_image</span><span class="p">()</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid format {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format</span><span class="p">))</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Image extent (`~astropy.coordinates.Angle`)</span>

<span class="sd">        The output array format is `(x_lo, x_hi, y_lo, y_hi)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span>
        <span class="n">by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span>
        <span class="k">return</span> <span class="n">Angle</span><span class="p">([</span><span class="n">bx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">by</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">by</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spectrum_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Spectrum extent (`~astropy.units.Quantity`)</span>

<span class="sd">        The output array format is  `(e_lo, e_hi)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span>
        <span class="k">return</span> <span class="n">Quantity</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">image_bin_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Image bin centers `(x, y)` (2x `~astropy.coordinates.Angle`)</span>

<span class="sd">        Returning two separate elements for the X and Y bin centers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">detx_bin_centers</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">dety_bin_centers</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">detx_bin_centers</span><span class="p">,</span> <span class="n">dety_bin_centers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">energy_bin_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Energy bin centers (logarithmic center) (`~astropy.units.Quantity`)&quot;&quot;&quot;</span>
        <span class="n">log_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">log_bin_centers</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">log_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">energy_bin_centers</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_bin_centers</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="c"># TODO: this function should be reviewed/re-written, when</span>
        <span class="c"># the following PR is completed:</span>
        <span class="c"># https://github.com/gammapy/gammapy/pull/290</span>
        <span class="c"># as suggested in:</span>
        <span class="c"># https://github.com/gammapy/gammapy/pull/292#discussion_r34412865</span>
        <span class="k">return</span> <span class="n">energy_bin_centers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">det_wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;WCS object describing the coordinates of the det (X, Y) bins (`~astropy.wcs.WCS`)</span>

<span class="sd">        This method gives the correct answer only for linear X, Y binning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wcs</span> <span class="o">=</span> <span class="n">linear_arrays_to_wcs</span><span class="p">(</span><span class="n">name_x</span><span class="o">=</span><span class="s">&quot;DETX&quot;</span><span class="p">,</span>
                                   <span class="n">name_y</span><span class="o">=</span><span class="s">&quot;DETY&quot;</span><span class="p">,</span>
                                   <span class="n">bin_edges_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">,</span>
                                   <span class="n">bin_edges_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wcs</span>

<div class="viewcode-block" id="CubeBackgroundModel.find_det_bin"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.find_det_bin">[docs]</a>    <span class="k">def</span> <span class="nf">find_det_bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">det</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the bins that contain the specified det (X, Y) pairs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        det : `~astropy.coordinates.Angle`</span>
<span class="sd">            array of det (X, Y) pairs to search for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bin_index : `~numpy.ndarray`</span>
<span class="sd">            array of integers with the indices (x, y) of the det</span>
<span class="sd">            bin containing the specified det (X, Y) pair</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># check that the specified det is within the boundaries of the model</span>
        <span class="n">det_extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_extent</span>
        <span class="n">check_x_lo</span> <span class="o">=</span> <span class="p">(</span><span class="n">det_extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">check_x_hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">det_extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">check_y_lo</span> <span class="o">=</span> <span class="p">(</span><span class="n">det_extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">det</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">check_y_hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">det</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">det_extent</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">check_x_lo</span> <span class="ow">and</span> <span class="n">check_x_hi</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">check_y_lo</span> <span class="ow">and</span> <span class="n">check_y_hi</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Specified det {0} is outside the boundaries {1}.&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">det_extent</span><span class="p">))</span>

        <span class="n">bin_index_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bin_index_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">det</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bin_index_x</span><span class="p">,</span> <span class="n">bin_index_y</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.find_energy_bin"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.find_energy_bin">[docs]</a>    <span class="k">def</span> <span class="nf">find_energy_bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the bins that contain the specified energy values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        energy : `~astropy.units.Quantity`</span>
<span class="sd">            array of energies to search for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bin_index : `~numpy.ndarray`</span>
<span class="sd">            indices of the energy bins containing the specified energies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># check that the specified energy is within the boundaries of the model</span>
        <span class="n">energy_extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_extent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">energy_extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">energy</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">energy</span> <span class="o">&lt;</span> <span class="n">energy_extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">ss_error</span> <span class="o">=</span> <span class="s">&quot;Specified energy {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="n">ss_error</span> <span class="o">+=</span> <span class="s">&quot; is outside the boundaries {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy_extent</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">ss_error</span><span class="p">)</span>

        <span class="n">bin_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">energy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bin_index</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.find_det_bin_edges"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.find_det_bin_edges">[docs]</a>    <span class="k">def</span> <span class="nf">find_det_bin_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">det</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the bin edges of the specified det (X, Y) pairs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        det : `~astropy.coordinates.Angle`</span>
<span class="sd">            array of det (X, Y) pairs to search for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bin_edges : `~astropy.coordinates.Angle`</span>
<span class="sd">            det bin edges (x_lo, x_hi, y_lo, y_hi)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bin_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_det_bin</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
        <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[</span><span class="n">bin_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">detx_bins</span><span class="p">[</span><span class="n">bin_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[</span><span class="n">bin_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">dety_bins</span><span class="p">[</span><span class="n">bin_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">bin_edges</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.find_energy_bin_edges"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.find_energy_bin_edges">[docs]</a>    <span class="k">def</span> <span class="nf">find_energy_bin_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the bin edges of the specified energy values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        energy : `~astropy.units.Quantity`</span>
<span class="sd">            array of energies to search for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bin_edges : `~astropy.units.Quantity`</span>
<span class="sd">            energy bin edges [E_min, E_max)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bin_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_energy_bin</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">[</span><span class="n">bin_index</span><span class="p">],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">energy_bins</span><span class="p">[</span><span class="n">bin_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">bin_edges</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.plot_image"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.plot_image">[docs]</a>    <span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">style_kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot image for the energy bin containing the specified energy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        energy : `~astropy.units.Quantity`</span>
<span class="sd">            energy of bin to plot the bg model</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`, optional</span>
<span class="sd">            axes of the figure for the plot</span>
<span class="sd">        style_kwargs : dict, optional</span>
<span class="sd">            style options for the plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`</span>
<span class="sd">            axes of the figure containing the plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

        <span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="c"># check shape of energy: only 1 value is accepted</span>
        <span class="n">nvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nvalues</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ss_error</span> <span class="o">=</span> <span class="s">&quot;Expected exactly 1 value for energy, got {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nvalues</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">ss_error</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_extent</span>
        <span class="n">energy_bin_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_bin_centers</span>

        <span class="c"># find energy bin containing the specified energy</span>
        <span class="n">energy_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_energy_bin</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="n">energy_bin_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_energy_bin_edges</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="n">ss_energy_bin_edges</span> <span class="o">=</span> <span class="s">&quot;[{0}, {1}) {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                      <span class="n">energy_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                      <span class="n">energy_bin_edges</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

        <span class="c"># get data for the plot</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">[</span><span class="n">energy_bin</span><span class="p">]</span>
        <span class="n">energy_bin_center</span> <span class="o">=</span> <span class="n">energy_bin_centers</span><span class="p">[</span><span class="n">energy_bin</span><span class="p">]</span>

        <span class="c"># create plot</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">do_not_close_fig</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="c"># if no axis object is passed by ref, the figure should remain open</span>
            <span class="n">do_not_close_fig</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">style_kwargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">style_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c">#import IPython; IPython.embed()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;cmap&#39;</span> <span class="ow">in</span> <span class="n">style_kwargs</span><span class="p">:</span>
            <span class="n">style_kwargs</span><span class="p">[</span><span class="s">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;afmhot&#39;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                          <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                          <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="c"># do not invert image</span>
                          <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">style_kwargs</span><span class="p">)</span>

        <span class="c"># set title and axis names</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Energy = [{0:.1f}, {1:.1f}) {2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                              <span class="n">energy_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                              <span class="n">energy_bin_edges</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X / {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extent</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y / {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extent</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>

        <span class="c"># draw color bar</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bg rate / {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>

        <span class="c"># eventually close figure to avoid white canvases</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_not_close_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span>
</div>
<div class="viewcode-block" id="CubeBackgroundModel.plot_spectrum"><a class="viewcode-back" href="../../../api/gammapy.background.CubeBackgroundModel.html#gammapy.background.CubeBackgroundModel.plot_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">plot_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">style_kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot spectra for the det bin containing the specified det (X, Y) pair.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        det : `~astropy.units.Quantity`</span>
<span class="sd">            det (X,Y) pair of bin to plot the bg model</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`, optional</span>
<span class="sd">            axes of the figure for the plot</span>
<span class="sd">        style_kwargs : dict, optional</span>
<span class="sd">            style options for the plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`</span>
<span class="sd">            axes of the figure containing the plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

        <span class="n">det</span> <span class="o">=</span> <span class="n">det</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c"># flatten</span>
        <span class="c"># check shape of det: only 1 pair is accepted</span>
        <span class="n">nvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">det</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">nvalues</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ss_error</span> <span class="o">=</span> <span class="s">&quot;Expected exactly 2 values for det (X, Y),&quot;</span>
            <span class="n">ss_error</span> <span class="o">+=</span> <span class="s">&quot;got {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nvalues</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">ss_error</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">do_only_1_plot</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">energy_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_bin_centers</span>
        <span class="n">detx_bin_centers</span><span class="p">,</span> <span class="n">dety_bin_centers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_bin_centers</span>

        <span class="c"># find det bin containing the specified det coordinates</span>
        <span class="n">det_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_det_bin</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
        <span class="n">det_bin_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_det_bin_edges</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
        <span class="n">ss_detx_bin_edges</span> <span class="o">=</span> <span class="s">&quot;[{0}, {1}) {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                    <span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                    <span class="n">det_bin_edges</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">ss_dety_bin_edges</span> <span class="o">=</span> <span class="s">&quot;[{0}, {1}) {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                    <span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                    <span class="n">det_bin_edges</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

        <span class="c"># get data for the plot</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">[:,</span> <span class="n">det_bin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">det_bin</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">detx_bin_center</span> <span class="o">=</span> <span class="n">detx_bin_centers</span><span class="p">[</span><span class="n">det_bin</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">dety_bin_center</span> <span class="o">=</span> <span class="n">dety_bin_centers</span><span class="p">[</span><span class="n">det_bin</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c"># create plot</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">do_not_close_fig</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="c"># if no axis object is passed by ref, the figure should remain open</span>
            <span class="n">do_not_close_fig</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">style_kwargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">style_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_points</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s">&#39;TeV&#39;</span><span class="p">),</span>
                        <span class="n">data</span><span class="p">,</span>
                        <span class="n">drawstyle</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="c"># connect points with lines</span>
                        <span class="o">**</span><span class="n">style_kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span> <span class="c"># double log scale # slow!</span>

        <span class="c"># set title and axis names</span>
        <span class="n">ss_detx_bin_edges</span> <span class="o">=</span> <span class="s">&quot;[{0:.1f}, {1:.1f}) {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                            <span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                            <span class="n">det_bin_edges</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">ss_dety_bin_edges</span> <span class="o">=</span> <span class="s">&quot;[{0:.1f}, {1:.1f}) {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                            <span class="n">det_bin_edges</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                                            <span class="n">det_bin_edges</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Det = {0} {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss_detx_bin_edges</span><span class="p">,</span> <span class="n">ss_dety_bin_edges</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;E / {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy_points</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Bg rate / {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>

        <span class="c"># eventually close figure to avoid white canvases</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_not_close_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="models.html#">Back to Top</a></p>
  <p>
    &copy; Copyright 2015, The Gammapy developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 13 Aug 2015. <br/>
  </p>
</footer>
  </body>
</html>